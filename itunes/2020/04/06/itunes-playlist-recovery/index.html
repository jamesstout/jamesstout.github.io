<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Recovering iTunes Playlists | stouty.xyz</title>
<meta name="description" content="Recovering iTunes Playlists after a disasterous move ">


  <meta name="author" content="James Stout">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="stouty.xyz">
<meta property="og:title" content="Recovering iTunes Playlists">
<meta property="og:url" content="https://stouty.xyz/itunes/2020/04/06/itunes-playlist-recovery/">


  <meta property="og:description" content="Recovering iTunes Playlists after a disasterous move ">





  <meta name="twitter:site" content="@stoutyhk">
  <meta name="twitter:title" content="Recovering iTunes Playlists">
  <meta name="twitter:description" content="Recovering iTunes Playlists after a disasterous move ">
  <meta name="twitter:url" content="https://stouty.xyz/itunes/2020/04/06/itunes-playlist-recovery/">

  
    <meta name="twitter:card" content="summary">
    
  

  
    <meta name="twitter:creator" content="@stoutyhk">
  



  <meta property="article:published_time" content="2020-04-06T00:48:34+08:00">






<link rel="canonical" href="https://stouty.xyz/itunes/2020/04/06/itunes-playlist-recovery/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "stouty.xyz",
      "url": "https://stouty.xyz/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="stouty.xyz Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<script src="/assets/files/head.load.min.js"></script>

<!-- <script defer src="/assets/files/lazysizes.min.js"></script> -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/> -->
<!-- <script src="https://kit.fontawesome.com/676698b110.js" crossorigin="anonymous"></script> -->
<script defer src="https://kit.fontawesome.com/4eee35f757.js"></script>
<style>
	.blur-up {
		-webkit-filter: blur(5px);
		filter: blur(5px);
		transition: filter 400ms, -webkit-filter 400ms;
	}

	.blur-up.lazyloaded {
		-webkit-filter: blur(0);
		filter: blur(0);
	}
</style>
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          stouty.xyz
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">about</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">tags</a>
            </li><li class="masthead__menu-item">
              <a href="/things-i-use/">things</a>
            </li><li class="masthead__menu-item">
              <a href="/links/">links</a>
            </li><li class="masthead__menu-item">
              <a href="/snippets/">snippets</a>
            </li><li class="masthead__menu-item">
              <a href="/sitemap.xml">sitemap</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">James Stout</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>iOS/Web developer. Tech, crypto, comedy, Hong Kong, hcafc, smashing telly and, of course, the weather</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Hong Kong</span>
        </li>
      

      

      

      

      
        <li>
          <a href="https://keybase.io/stouty" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fas fa-fw fa-key" aria-hidden="true"></i> Keybase
          </a>
        </li>
      

      
        <li>
          <a href="https://twitter.com/stoutyhk" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      
      
      

      

      

      

      
        <li>
          <a href="https://bitbucket.org/stouty" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-bitbucket" aria-hidden="true"></i> Bitbucket
          </a>
        </li>
      

      
        <li>
          <a href="https://github.com/jamesstout" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://last.fm/user/stoutyhk" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-lastfm-square" aria-hidden="true"></i> Last.fm
          </a>
        </li>
      

      

      

      

      

      

      

      
      <li>
        <a href="http://www.feedio.co/@stoutyhk?came_from=homepagefeedbutton" itemprop="sameAs">
          <i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feedio
        </a>
      </li>
    

    
    <li>
      <a rel="me" href="https://mastodon.social/@stouty" itemprop="sameAs">
        <i class="fab fa-fw fa-mastodon" aria-hidden="true"></i> Mastodon
      </a>
    </li>
       

      

      

      

      

      
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Recovering iTunes Playlists">
    <meta itemprop="description" content="Recovering iTunes Playlists after a disasterous move">
    <meta itemprop="datePublished" content="2020-04-06T00:48:34+08:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Recovering iTunes Playlists
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>I moved my iTunes Music folder to a new disc, I don’t think I did it properly, so all my playlists were empty, the tracks in the exported playlist XML had new IDs and locations.</p>

<p>There might be a way to recover using iTunes, but with a 250GB library, it’s a faff moving it around.</p>

<p>So I found myself with an new ‘iTunes Library.xml’ with empty playlists, but with the new track IDs, and an old ‘iTunes Music Library.xml’ with the old track IDs and names.</p>

<p><img data-src="/assets/images/posts/itunes-playlist-recovery/old-itunes.png" class="lazyload blur-up" alt="itunes screenshot" />
<img data-src="/assets/images/posts/itunes-playlist-recovery/new-itunes.png" class="lazyload blur-up" alt="itunes screenshot" /></p>

<p>What I needed was a way, for each track in each playlist in the old library, to look up the ID in the new library, using the track name and other properties to find the track in the new library, then export a new playlist XML.</p>

<p>I found an <a href="https://github.com/mheap/iTunes-Library-Parser">iTunes Library parser</a>, extended it to load <a href="https://github.com/jamesstout/iTunes-Library-Parser/blob/71cfc95b2f55ae581ccc9647fd4e0decb0ae438e/iTunesLibrary.php">playlists</a>, and  provide a new <a href="https://github.com/jamesstout/iTunes-Library-Parser/blob/71cfc95b2f55ae581ccc9647fd4e0decb0ae438e/iTunesLibrary.php#L130-L214">function</a> to look up a track, in say a new iTunes library, given the name, artist, album and track time.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="nf">getIDAndLocation</span><span class="p">(</span><span class="nv">$trackID</span><span class="p">,</span> <span class="nv">$trackName</span><span class="p">,</span> <span class="nv">$totalTime</span><span class="p">,</span> <span class="nv">$artist</span><span class="p">,</span> <span class="nv">$album</span><span class="p">){</span>

    <span class="c1">// error checks</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$trackName</span> <span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
      <span class="k">echo</span> <span class="s2">"track name null</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$match</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="nv">$potentialMatch</span><span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">foreach</span> <span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_tracks</span> <span class="k">as</span> <span class="nv">$track</span> <span class="p">)</span> <span class="p">{</span>
      <span class="c1">// match on as much as possible</span>
      <span class="k">if</span><span class="p">(</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Name</span> <span class="o">==</span> <span class="nv">$trackName</span> <span class="o">&amp;&amp;</span>  
        <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$totalTime</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Total_Time</span> <span class="o">==</span> <span class="nv">$totalTime</span><span class="p">)</span> <span class="o">&amp;&amp;</span>  
        <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$artist</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Artist</span> <span class="o">==</span> <span class="nv">$artist</span><span class="p">)</span> <span class="o">&amp;&amp;</span>  
        <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$album</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Album</span> <span class="o">==</span> <span class="nv">$album</span><span class="p">)</span>
        <span class="p">){</span>
          <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Track_ID</span><span class="p">,</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Location</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// if no match, construct some potential matches</span>
      <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s2">"TotalTime"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$totalTime</span><span class="p">;</span>
      <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s2">"Artist"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$artist</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">?</span> <span class="nv">$artist</span> <span class="o">:</span> <span class="s2">"NO ARTIST"</span><span class="p">);</span>
      <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s2">"Album"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$album</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">?</span> <span class="nv">$album</span> <span class="o">:</span> <span class="s2">"NO ALBUM"</span><span class="p">);</span>

      <span class="c1">// tmp vars</span>
      <span class="nv">$tmpArtist</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Artist</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span> <span class="o">?</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Artist</span> <span class="o">:</span> <span class="s2">"NO ARTIST"</span><span class="p">);</span>
      <span class="nv">$tmpAlbum</span> <span class="o">=</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Album</span><span class="p">)</span> <span class="o">==</span> <span class="kc">true</span> <span class="o">?</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Album</span> <span class="o">:</span> <span class="s2">"NO ALBUM"</span><span class="p">);</span>

      <span class="c1">// if track name, total time and artist match, grab the details</span>
      <span class="k">if</span> <span class="p">(</span><span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Total_Time</span> <span class="o">==</span> <span class="nv">$totalTime</span> <span class="o">&amp;&amp;</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Name</span> <span class="o">==</span> <span class="nv">$trackName</span> <span class="o">&amp;&amp;</span> <span class="nb">is_null</span><span class="p">(</span><span class="nv">$artist</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="o">&amp;&amp;</span> <span class="nv">$tmpArtist</span> <span class="o">==</span> <span class="nv">$artist</span><span class="p">)</span> <span class="p">{</span>

          <span class="nv">$match</span><span class="o">++</span><span class="p">;</span>

          <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s1">'Match'</span><span class="p">][</span><span class="nv">$match</span><span class="p">][</span><span class="s2">"Type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Name_TotalTime"</span><span class="p">;</span>
          <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s1">'Match'</span><span class="p">][</span><span class="nv">$match</span><span class="p">][</span><span class="s2">"Name"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Name</span><span class="p">;</span>
          <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s1">'Match'</span><span class="p">][</span><span class="nv">$match</span><span class="p">][</span><span class="s2">"Track_ID"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Track_ID</span><span class="p">;</span>
          <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s1">'Match'</span><span class="p">][</span><span class="nv">$match</span><span class="p">][</span><span class="s2">"TotalTime"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Total_Time</span><span class="p">;</span>
          <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s1">'Match'</span><span class="p">][</span><span class="nv">$match</span><span class="p">][</span><span class="s2">"Artist"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$tmpArtist</span><span class="p">;</span>
          <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s1">'Match'</span><span class="p">][</span><span class="nv">$match</span><span class="p">][</span><span class="s2">"Album"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$tmpAlbum</span><span class="p">;</span>
          <span class="nv">$potentialMatch</span><span class="p">[</span><span class="nv">$trackName</span><span class="p">][</span><span class="s1">'Match'</span><span class="p">][</span><span class="nv">$match</span><span class="p">][</span><span class="s2">"Location"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$track</span><span class="o">-&gt;</span><span class="na">Location</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$match</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">echo</span> <span class="s2">"for: [</span><span class="nv">$trackID</span><span class="s2">], [</span><span class="nv">$trackName</span><span class="s2">], [</span><span class="nv">$totalTime</span><span class="s2">], [</span><span class="nv">$artist</span><span class="s2">], [</span><span class="nv">$album</span><span class="s2">]</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

      <span class="nv">$tmpTrackID</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
      <span class="nv">$tmpLocation</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
      <span class="nv">$tmpAlbum</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>

      <span class="c1">// choose best</span>
      <span class="c1">// we know name, time and artist match</span>
      <span class="c1">// choose first with an album?</span>
      <span class="c1">// then if there is another match without an album</span>
      <span class="c1">// use that</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="nv">$potentialMatch</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$value</span><span class="p">[</span><span class="s1">'Match'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>

          <span class="k">if</span><span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">'Album'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'NO ALBUM'</span><span class="p">){</span>
            <span class="nv">$tmpTrackID</span><span class="o">=</span><span class="nv">$v</span><span class="p">[</span><span class="s2">"Track_ID"</span><span class="p">];</span>
            <span class="nv">$tmpLocation</span><span class="o">=</span><span class="nv">$v</span><span class="p">[</span><span class="s2">"Location"</span><span class="p">];</span>
            <span class="nv">$tmpAlbum</span><span class="o">=</span><span class="nv">$v</span><span class="p">[</span><span class="s2">"Album"</span><span class="p">];</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="k">if</span><span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">'Album'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'NO ALBUM'</span><span class="p">){</span>
            <span class="nv">$tmpTrackID</span><span class="o">=</span><span class="nv">$v</span><span class="p">[</span><span class="s2">"Track_ID"</span><span class="p">];</span>
            <span class="nv">$tmpLocation</span><span class="o">=</span><span class="nv">$v</span><span class="p">[</span><span class="s2">"Location"</span><span class="p">];</span>
            <span class="nv">$tmpAlbum</span><span class="o">=</span><span class="nv">$v</span><span class="p">[</span><span class="s2">"Album"</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">echo</span> <span class="s2">"match is now: [</span><span class="nv">$tmpTrackID</span><span class="s2">], [</span><span class="nv">$tmpAlbum</span><span class="s2">]</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
      <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="nv">$tmpTrackID</span><span class="p">,</span> <span class="nv">$tmpLocation</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// could exit or log error here...</span>
    <span class="k">echo</span> <span class="s2">"could not match: [</span><span class="nv">$trackName</span><span class="s2">], [</span><span class="nv">$totalTime</span><span class="s2">], [</span><span class="nv">$artist</span><span class="s2">], [</span><span class="nv">$album</span><span class="s2">]</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Next, I wrote a <a href="https://git.stouty.xyz/stouty/iTunes-Playlist-Recoverer/src/commit/d502155e38008145a013ca253c990dedba219a86/playlistRecover.php">script</a> that loads up the old library file and the playlist info (with stale track IDs), loads the new library file with the new trackIDs. The script loops through each playlist, gets the new trackID for each track in a playlist, then writes the new playlist to an XML file that iTunes can import.</p>

<p>A snippet:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$newiTunesFile</span> <span class="o">=</span> <span class="s1">'iTunes-new.xml'</span><span class="p">;</span>
<span class="nv">$oldiTunesFile</span> <span class="o">=</span> <span class="s1">'iTunes-old.xml'</span><span class="p">;</span>

<span class="nv">$trackLimit</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span>

<span class="nv">$writeNewPlaylistFile</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nv">$outputDir</span> <span class="o">=</span> <span class="s2">"newPlaylists"</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$writeNewPlaylistFile</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$outputDir</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$outputDir</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// load up old library, and playlists</span>
<span class="nv">$oldLibrary</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">iTunesLibrary</span><span class="p">(</span><span class="nv">$oldiTunesFileGZ</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">$trackLimit</span><span class="p">);</span>

<span class="c1">// load up new library, just the tracks</span>
<span class="nv">$newLibrary</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">iTunesLibrary</span><span class="p">(</span><span class="nv">$newiTunesFileGZ</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$oldLibrary</span><span class="o">-&gt;</span><span class="na">getPlaylists</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$playlist</span><span class="p">)</span> <span class="p">{</span>

    <span class="nv">$time_start</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$playlist</span><span class="o">-&gt;</span><span class="na">tracks</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$playlist</span><span class="o">-&gt;</span><span class="na">tracks</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nv">$trackLimit</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">echo</span> <span class="s2">"Playlist Name: </span><span class="nv">$playlist-&gt;Name</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>

        <span class="nv">$newTrackIDs</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$playlist</span><span class="o">-&gt;</span><span class="na">tracks</span> <span class="k">as</span> <span class="nv">$trackID</span> <span class="o">=&gt;</span> <span class="nv">$trackValues</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">list</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$location</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$newLibrary</span><span class="o">-&gt;</span><span class="na">getIDAndLocation</span><span class="p">(</span><span class="nv">$trackID</span><span class="p">,</span> <span class="nv">$trackValues</span><span class="p">[</span><span class="s2">"Name"</span><span class="p">],</span> <span class="nv">$trackValues</span><span class="p">[</span><span class="s2">"Total_Time"</span><span class="p">],</span> <span class="nv">$trackValues</span><span class="p">[</span><span class="s2">"Artist"</span><span class="p">],</span> <span class="nv">$trackValues</span><span class="p">[</span><span class="s2">"Album"</span><span class="p">]);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$newTrackIDs</span><span class="p">[]</span><span class="o">=</span><span class="nv">$id</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="c1">// echo "OHNO: Could not find new ID for: " . $trackValues["Name"] . "\n";</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// write new xml, need name and trackIds</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$writeNewPlaylistFile</span> <span class="o">==</span> <span class="kc">true</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$newTrackIDs</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">outputPlaylistFile</span><span class="p">(</span><span class="nv">$playlist</span><span class="o">-&gt;</span><span class="na">Name</span><span class="p">,</span> <span class="nv">$newTrackIDs</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here’s what it looks like when it runs:</p>

<script id="asciicast-2gzHk9rSm3ETs9yHwc0o9ICWr" src="https://asciinema.org/a/2gzHk9rSm3ETs9yHwc0o9ICWr.js" async="" data-preload="false"></script>

<p>Your newPlaylist folder will now contain all your playlists, with refreshed trackIDs, ready to import to iTunes, a manual step alas.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#itunes" class="page__taxonomy-item" rel="tag">iTunes</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#php" class="page__taxonomy-item" rel="tag">PHP</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#playlists" class="page__taxonomy-item" rel="tag">playlists</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#itunes" class="page__taxonomy-item" rel="tag">iTunes</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-04-06T00:48:34+08:00">April 6, 2020</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/macos/2020/04/05/zoom/" class="pagination--pager" title="Zoom for Mac Entitlements
">Previous</a>
    
    
      <a href="/unix/2020/04/16/dupes/" class="pagination--pager" title="Finding duplicate files
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/nextcloud/2020/05/17/nextcloud-conflicting-files/" rel="permalink">Fixing Nextcloud Conflicting Files
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">A bash script to correct conflicting files.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ios/2020/05/15/firebase-crashlytics/" rel="permalink">Firebase Crashlytics - Are They Having a Laugh?
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Investigating the new Firebase Crashlytics SDK.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/webdev/2020/05/11/copy-site-jekyll-hook/" rel="permalink">A Jekyll Hook to Copy Pre-Built Site to Another Directory
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">My first attempt at a Jekyll plugin, it copies the _site folder somewhere else.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/macos/2020/05/11/zoom-update/" rel="permalink">A Quick Update on Zoom Code Signing
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">A quick update on Zoom code signing.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><div class="search-searchbar"></div>
  <div class="search-hits"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 stouty.xyz. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script defer src="/assets/files/lazysizes.min.js"></script>
  <script defer src="/assets/js/main.min.js"></script>
  <!-- <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script> -->
  <!-- <script defer src="https://kit.fontawesome.com/4eee35f757.js"></script> -->



<!-- Including InstantSearch.js library and styling -->

<script>
  head.load("https://cdn.jsdelivr.net/npm/instantsearch.js@2.9.0/dist/instantsearch.min.js", function() {
    // Instanciating InstantSearch.js with Algolia credentials
    const search = instantsearch({
      appId: 'TE1537XNZ4',
      apiKey: 'c3967c693f4a1d3ca8ed221f259c6a5f',
      indexName: 'stouty.xyz',
      searchParameters: {
        restrictSearchableAttributes: [
        'title',
        'content'
        ]
      }
    });
    
    const hitTemplate = function(hit) {
      const url = hit.url;
      const title = (hit._highlightResult.title !== undefined) ? hit._highlightResult.title.value : "";
      const content = (hit._highlightResult.html !== undefined) ? hit._highlightResult.html.value : undefined;
      
      if(content === undefined){
        throw "whoops";
      }
      else{
        return `
        <div class="list__item">
          <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
            <h2 class="archive__item-title" itemprop="headline"><a href="${url}">${title}</a></h2>
            <div class="archive__item-excerpt" itemprop="description">${content}</div>
          </article>
        </div>
        `;
      }
    }
    
    // Adding searchbar and results widgets
    search.addWidget(
    instantsearch.widgets.searchBox({
      container: '.search-searchbar',
      poweredBy: true,
      placeholder: 'Enter your search term...'
    })
    );
    search.addWidget(
    instantsearch.widgets.hits({
      container: '.search-hits',
      templates: {
        item: hitTemplate
      }
    })
    );
    
    // Starting the search
    search.start();
  });
</script>

<!-- <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.8.0/dist/instantsearch.min.js"></script> -->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.9.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.9.0/dist/instantsearch-theme-algolia.min.css">







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-121620384-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-121620384-1', { 'anonymize_ip': false});
</script>





<style>
    .videoWrapper {
        position: relative;
        padding-bottom: 56.333%;
        height: 0;
        background: black;
    }
    .videoWrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 0;
    }    
    </style>
    
    <script>
    function get_youtube_id(url) {
        var p = /^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;
        return (url.match(p)) ? RegExp.$1 : false;
    }
    function vimeo_embed(url,el) {
        var id = false;
        $.ajax({
          url: 'https://vimeo.com/api/oembed.json?url='+url,
          async: true,
          success: function(response) {
            if(response.video_id) {
              id = response.video_id;
              if(url.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
              if(url.indexOf('loop=1') !== -1) var loop=1; else var loop=0;
              var theInnerHTML = '<div class="videoWrapper"><iframe src="https://player.vimeo.com/video/'+id+'/?byline=0&title=0&portrait=0';
              if(autoplay==1) theInnerHTML += '&autoplay=1';
              if(loop==1) theInnerHTML += '&loop=1';
              theInnerHTML += '" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>'; 
              el.innerHTML = theInnerHTML;
            }
          }
        });
    }
    function video_embed() {
        var p = document.getElementsByTagName('p');
        for(var i = 0; i < p.length; i++) {
            //check if this is an external url (that starts with https:// or http://
            if (p[i].innerHTML.indexOf("http://") == 0 ||
                p[i].innerHTML.indexOf("https://") == 0) {
                var youtube_id = get_youtube_id(p[i].innerHTML);
                if(youtube_id) {
                    if(p[i].innerHTML.indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
                    if(p[i].innerHTML.indexOf('loop=1') !== -1) var loop=1; else var loop=0;
                    var theInnerHTML = '<div class="videoWrapper"><iframe width="720" height="420" src="https://www.youtube.com/embed/' + youtube_id + '?rel=0&showinfo=0';
                    if(autoplay==1) theInnerHTML += '&autoplay=1';
                    if(loop==1) theInnerHTML += '&loop=1&playlist='+youtube_id+'&version=3';
                    if(p[i].innerHTML.indexOf('start=') !== -1) theInnerHTML += '&start='+p[i].innerHTML.substring(p[i].innerHTML.indexOf('start=')+6);
                    theInnerHTML += '" frameborder="0" allowfullscreen></iframe></div>';
                    p[i].innerHTML = theInnerHTML;
                }
                if(p[i].innerHTML.indexOf('vimeo.com') !== -1) {
                    //ask vimeo for the id and place the embed
                    vimeo_embed(p[i].innerHTML,p[i]);
                }
            }
        }
    }
    video_embed();
    
    function mp3_embed() {
        var p = document.getElementsByTagName('p');
        for(var i = 0; i < p.length; i++) {
            if(p[i].innerHTML.indexOf('.mp3') !== -1) {
                var str = p[i].innerHTML.split('?');
                if(str.length == 1) str[1] = '';
                var str1 = str[1];
                str1 = str1.replace('&','').replace('&','');
                str1 = str1.replace('autoplay=1','').replace('autoplay=0','');
                str1 = str1.replace('loop=1','').replace('loop=0','');
                str1 = str1.replace('controls=0','').replace('controls=1','');
    
                if (str[0].lastIndexOf('.mp3', str[0].length - 4) === str[0].length - 4 && str1.length == 0) {
                    if(str[1].indexOf('autoplay=1') !== -1) var autoplay=1; else var autoplay=0;
                    if(str[1].indexOf('loop=1') !== -1) var loop=1; else var loop=0;
                    if(str[1].indexOf('controls=0') !== -1) var controls=0; else var controls=1;
                    var newInnerHTML = '<audio';
                    if(autoplay==1) newInnerHTML += ' autoplay';
                    if(loop==1) newInnerHTML += ' loop';
                    if(controls==1) newInnerHTML += ' controls';
                    newInnerHTML += '><source src="'+str[0]+'" type="audio/mpeg">Your browser does not support the audio element.</audio>';
                    p[i].innerHTML = newInnerHTML;
                }
            }
        }
    }
    mp3_embed();
    </script>
<script type='text/javascript'>
  
// Some default pre init
var Countly = Countly || {};
Countly.q = Countly.q || [];

// Provide your app key that you retrieved from Countly dashboard
Countly.app_key = "dee9c2749f061f14aaf935c34b3dc6f0d73d6adb";

// Provide your server IP or name. Use try.count.ly or us-try.count.ly 
// or asia-try.count.ly for EE trial server.
// If you use your own server, make sure you have https enabled if you use
// https below.
Countly.url = "https://countly.hkwarnings.com/"; 

// Start pushing function calls to queue
// Track sessions automatically (recommended)
Countly.q.push(['track_sessions']);
  
//track web page views automatically (recommended)
Countly.q.push(['track_pageview']);
 
Countly.q.push(['track_errors']);

// Uncomment the following line to track web heatmaps (Enterprise Edition)
// Countly.q.push(['track_clicks']);

// Uncomment the following line to track web scrollmaps (Enterprise Edition)
// Countly.q.push(['track_scrolls']);
  
// Load Countly script asynchronously
(function() {
	var cly = document.createElement('script'); cly.type = 'text/javascript'; 
	cly.async = true;
	// Enter url of script here (see below for other option)
	cly.src = 'https://stouty.xyz/assets/files/countly.min.js';
	cly.onload = function(){Countly.init()};
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(cly, s);
})();
</script>




  </body>
</html>
