(function(b,s){"function"===typeof define&&define.amd?define([],function(){return s(b.Countly)}):"object"===typeof module&&module.exports?module.exports=s(b.Countly):b.Countly=s(b.Countly)})("undefined"!==typeof window?window:this,function(b){function s(a){if(!b.ignore_visitor)if(a.key){a.count||(a.count=1);var c=J(a,["key","count","sum","dur","segmentation"]);c.timestamp=Z();var e=new Date;c.hour=e.getHours();c.dow=e.getDay();q.push(c);g("cly_event",q);i("Adding event: ",a)}else i("Event must have key property")}
function na(){b.ignore_prefetch&&("undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState)&&(b.ignore_visitor=!0);b.ignore_bots&&La.test(navigator.userAgent)&&(b.ignore_visitor=!0)}function oa(a){var b=[];if("undefined"!==typeof a.options)for(var e=0;e<a.options.length;e++)a.options[e].selected&&b.push(a.options[e].value);return b.join(", ")}function pa(){var a;if("undefined"!==typeof b.onload&&0<b.onload.length){for(a=0;a<b.onload.length;a++)if("function"===typeof b.onload[a])b.onload[a]();
b.onload=[]}}function $(a,c){try{var e=document.createElement("div");e.className="countly-iframe-wrapper";e.id="countly-iframe-wrapper-"+a._id;var f=document.createElement("span");f.className="countly-feedback-close-icon";f.id="countly-feedback-close-icon-"+a._id;f.innerText="x";var j=document.createElement("iframe");j.name="countly-feedback-iframe";j.id="countly-feedback-iframe";j.src=b.url+"/feedback?widget_id="+a._id+"&app_key="+b.app_key+"&device_id="+b.device_id+"&sdk_version="+qa;document.body.appendChild(e);
e.appendChild(f);e.appendChild(j);l(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(c){var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.id="feedback-sticker-svg";d.setAttribute("aria-hidden","true");d.setAttribute("data-prefix","far");d.setAttribute("data-icon","grin");d.setAttribute("class","svg-inline--fa fa-grin fa-w-16");
d.setAttribute("role","img");d.setAttribute("xmlns","http://www.w3.org/2000/svg");d.setAttribute("viewBox","0 0 496 512");var h=document.createElementNS("http://www.w3.org/2000/svg","path");h.id="smileyPathInStickerSvg";h.setAttribute("fill","white");h.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");
var z=document.createElement("span");z.innerText=a.trigger_button_text;var g=document.createElement("div");g.style.color=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color;g.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;g.className="countly-feedback-sticker  "+a.trigger_position+"-"+a.trigger_size;g.id="countly-feedback-sticker-"+a._id;d.appendChild(h);g.appendChild(d);g.appendChild(z);document.body.appendChild(g);var k=document.getElementById("smileyPathInStickerSvg");
k&&(k.style.fill=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color);l(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(m){i("Somethings went wrong while element injecting process: "+
m)}}function aa(){if(G){var a={name:G};b.check_consent("views")&&s({key:"[CLY]_view",dur:H?n()-N:O,segmentation:a});G=null}}function ra(){if(K){var a=g("cly_session");if(!a||parseInt(a)<=n())A=!1,b.begin_session(!P);g("cly_session",n()+60*Q)}}function sa(a){a.app_key=b.app_key;a.device_id=b.device_id;a.sdk_name=Ma;a.sdk_version=qa;b.check_consent("location")?(b.country_code&&(a.country_code=b.country_code),b.city&&(a.city=b.city),null!==b.ip_address&&(a.ip_address=b.ip_address)):a.location="";a.timestamp=
Z();var c=new Date;a.hour=c.getHours();a.dow=c.getDay()}function r(a){b.ignore_visitor||(!b.app_key||!b.device_id?i("app_key or device_id is missing"):(sa(a),p.length>ba&&p.shift(),p.push(a),g("cly_queue",p,!0)))}function R(){pa();if(b.test_mode||b.ignore_visitor)ca=!1;else{ca=!0;var a=0;if("undefined"!==typeof b.q&&0<b.q.length){var c,e=b.q;b.q=[];for(a=0;a<e.length;a++)if(c=e[a],i("Processing queued call",c),"function"===typeof c)c();else if(Array.isArray(c)&&0<c.length)if("undefined"!==typeof b[c[0]])b[c[0]].apply(null,
c.slice(1));else{var f=c[0].replace("userData.","");"undefined"!==typeof b.userData[f]&&b.userData[f].apply(null,c.slice(1))}}A&&(P&&H)&&(a=n(),a-B>da&&(b.session_duration(a-B),B=a));0<q.length&&(q.length<=S?(r({events:JSON.stringify(q)}),q=[]):(a=q.splice(0,S),r({events:JSON.stringify(a)})),g("cly_event",q));!w&&(0<p.length&&ea&&n()>ta)&&(ea=!1,a=p[0],ua(y)&&(C&&(clearTimeout(C),C=null),a.consent=JSON.stringify(y),y={}),i("Processing request",a),g("cly_queue",p,!0),L(b.url+Na,a,function(a,b){i("Request Finished",
b,a);a?ta=n()+fa:p.shift();g("cly_queue",p,!0);ea=!0}));setTimeout(R,ga)}}function ha(){return g("cly_id")||va()}function va(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var e=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===b?e:e&3|8).toString(16)})}function T(){var a={};a._app_version=b.metrics._app_version||b.app_version;a._ua=b.metrics._ua||navigator.userAgent;if(screen.width){var c=screen.width?parseInt(screen.width):0,e=screen.height?
parseInt(screen.height):0;if(0!==c&&0!==e){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)c=Math.round(c*window.devicePixelRatio),e=Math.round(e*window.devicePixelRatio);else if(90===Math.abs(window.orientation))var f=c,c=e,e=f;a._resolution=b.metrics._resolution||""+c+"x"+e}}window.devicePixelRatio&&(a._density=b.metrics._density||window.devicePixelRatio);c=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;
"undefined"!==typeof c&&(a._locale=b.metrics._locale||c);if("undefined"!==typeof document.referrer&&document.referrer.length&&(c=wa.exec(document.referrer))&&c[11]&&c[11]!==window.location.hostname){c=!1;if(D&&D.length)for(e=0;e<D.length;e++)try{if(RegExp(D[e]).test(document.referrer)){i("Ignored:",document.referrer);c=!0;break}}catch(j){i("Problem with regex",D[e])}c||(a._store=b.metrics._store||document.referrer)}i("Got metrics",a);return a}function i(){b.debug&&"undefined"!==typeof console&&(arguments[1]&&
"object"==typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),console.log(Array.prototype.slice.call(arguments).join("\n")))}function n(){return Math.floor((new Date).getTime()/1E3)}function Z(){var a=(new Date).getTime();U>=a?U++:U=a;return U}function k(a,c,e){return"undefined"!==typeof c[a]?c[a]:"undefined"!==typeof b[a]?b[a]:e}function M(a,c,e){if(b.check_consent("crashes")&&a){var e=e||xa,f="";"object"===typeof a?"undefined"!==typeof a.stack?f=a.stack:("undefined"!==typeof a.name&&
(f+=a.name+":"),"undefined"!==typeof a.message&&(f+=a.message+"\n"),"undefined"!==typeof a.fileName&&(f+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(f+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(f+=":"+a.columnNumber)):f=a+"";c=c?!0:!1;a=T();f={_resolution:a._resolution,_error:f,_app_version:a._app_version,_run:n()-ya,_not_os_specific:!0};if(a=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)f._bat=Math.floor(100*a.level);"undefined"!==
typeof navigator.onLine&&(f._online=navigator.onLine?!0:!1);f._background=document.hasFocus()?!1:!0;0<I.length&&(f._logs=I.join("\n"));I=[];f._nonfatal=c;f._view=b.getViewName();"undefined"!==typeof e&&(f._custom=e);try{var j=document.createElement("canvas").getContext("experimental-webgl");f._opengl=j.getParameter(j.VERSION)}catch(d){}r({crash:JSON.stringify(f)})}}function L(a,c,e){try{i("Sending XML HTTP request");var f=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):
null,c=c||{},j=za(c),d="GET";if(b.force_post||2E3<=j.length)d="POST";"GET"===d?f.open("GET",a+"?"+j,!0):(f.open("POST",a,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"));for(var h in b.headers)f.setRequestHeader(h,b.headers[h]);f.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"===typeof e&&e(!1,c,this.responseText):4===this.readyState&&(i("Failed Server XML HTTP request",this.status),"function"===typeof e&&e(!0,c))};"GET"===
d?f.send():f.send(j)}catch(g){i("Failed XML HTTP request",g),"function"===typeof e&&e(!0,c)}}function za(a){var b=[],e;for(e in a)b.push(e+"="+encodeURIComponent(a[e]));return b.join("&")}function Aa(a){return"/"===a.substr(a.length-1)?a.substr(0,a.length-1):a}function J(a,b){for(var e={},f,j=0;j<b.length;j++)f=b[j],"undefined"!==typeof a[f]&&(e[f]=a[f]);return e}function ia(a){"undefined"==typeof a.pageY&&("number"==typeof a.clientX&&document.documentElement)&&(a.pageX=a.clientX+document.body.scrollLeft+
document.documentElement.scrollLeft,a.pageY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);return a}function ja(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function ka(){var a=document;return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),
Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function Ba(){var a=document;return Math.min(Math.min(a.body.clientHeight,a.documentElement.clientHeight),Math.min(a.body.offsetHeight,a.documentElement.offsetHeight),window.innerHeight)}function Ca(a){g("cly_token",a)}function ua(a){if(a)for(var b in a)if(Object.prototype.hasOwnProperty.call(a,b))return!0;return!1}function Da(a,b,e,f,j,d){var a=document.createElement(a),h;a.setAttribute(b,e);a.setAttribute(f,j);d&&(a.onreadystatechange=
a.onload=function(){h||d();h=!0});document.getElementsByTagName("head")[0].appendChild(a)}function Ea(a,b){Da("script","type","text/javascript","src",a,b)}function Fa(a,b){Da("link","rel","stylesheet","href",a,b)}function Ga(){var a=document.getElementById("cly-loader");if(!a){i("setting up loader");var a=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
b.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
a.appendChild(b);a=document.createElement("div");a.setAttribute("id","cly-loader");document.body.appendChild(a)}a.style.display="block"}function Ha(){var a=document.getElementById("cly-loader");a&&(a.style.display="none")}var b=b||{},qa="20.04",Ma="javascript_native_web",Ia=!1,A=!1,Na="/i",ga=500,ba=1E3,p=[],q=[],u={},I=[],E={},D=[],xa=null,P=!0,B,Ja=0,G=null,N=0,O=0,ta=0,fa=60,V=20,W=0,da=60,S=10,la=100,K=!0,Q=30,U=0,ea=!0,ca=!1,w=!1,y={},t={},wa=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
La=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/,
H=!0,ya;b.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm".split(" ");for(var m={},F=0;F<b.features.length;F++)m[b.features[F]]={};b.init=function(a){if(!Ia){a=a||{};b.namespace=k("namespace",a,"");ya=n();Ia=!0;p=g("cly_queue")||[];E={};q=g("cly_event")||[];u=g("cly_remote_configs")||{};ga=k("interval",a,ga);ba=k("queue_size",a,ba);w=k("offline_mode",a,w);fa=k("fail_timeout",a,fa);V=k("inactivity_time",a,V);da=k("session_update",a,da);S=k("max_events",
a,S);la=k("max_logs",a,la);K=k("use_session_cookie",a,K);Q=k("session_cookie_timeout",a,Q);b.ignore_prefetch=k("ignore_prefetch",a,!0);b.debug=k("debug",a,!1);b.app_key=k("app_key",a,null);b.test_mode=k("test_mode",a,!1);b.metrics=k("metrics",a,{});b.headers=k("headers",a,{});w?b.device_id||(b.device_id="[CLY]_temp_id"):b.device_id=k("device_id",a,ha());b.url=Aa(k("url",a,""));b.app_version=k("app_version",a,"0.0");b.country_code=k("country_code",a,null);b.city=k("city",a,null);b.ip_address=k("ip_address",
a,null);b.ignore_bots=k("ignore_bots",a,!0);b.force_post=k("force_post",a,!1);b.remote_config=k("remote_config",a,!1);b.q=b.q||[];b.onload=b.onload||[];b.ignore_visitor=k("ignore_visitor",a,!1);b.require_consent=k("require_consent",a,!1);a.ignore_referrers&&Array.isArray(a.ignore_referrers)?D=a.ignore_referrers:b.ignore_referrers&&Array.isArray(b.ignore_referrers)&&(D=b.ignore_referrers);""===b.url&&(i("Please provide server URL"),b.ignore_visitor=!0);g("cly_ignore")&&(b.ignore_visitor=!0);na();if(window.name&&
0===window.name.indexOf("cly:"))try{b.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(c){i("Could not parse name",window.name)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{b.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(e){i("Could not parse hash",location.hash)}b.passed_data&&(b.passed_data.token&&b.passed_data.purpose)&&(b.passed_data.token!==g("cly_old_token")&&(Ca(b.passed_data.token),g("cly_old_token",b.passed_data.token)),"heatmap"===b.passed_data.purpose&&
(b.ignore_visitor=!0,Ga(),Ea(b.url+"/views/heatmap.js",Ha)));if(!b.ignore_visitor){i("Countly initialized");b.onload.constructor!==Array&&(b.onload=[]);b.q.constructor!==Array&&(b.q=[]);a=0;b.utm=b.utm||{source:!0,medium:!0,campaign:!0,term:!0,content:!0};if(location.search){for(var f=location.search.substring(1).split("&"),j={},d=!1,a=0;a<f.length;a++){var h=f[a].split("=");"cly_id"===h[0]?g("cly_cmp_id",h[1]):"cly_uid"===h[0]?g("cly_cmp_uid",h[1]):"cly_device_id"===h[0]?b.device_id=h[1]:0===(h[0]+
"").indexOf("utm_")&&b.utm[h[0].replace("utm_","")]&&(j[h[0].replace("utm_","")]=h[1],d=!0)}if(d){for(var z in b.utm)j[z]?b.userData.set("utm_"+z,j[z]):b.userData.unset("utm_"+z);b.userData.save()}}w||b.device_id!==g("cly_id")&&g("cly_id",b.device_id);R();pa();b.remote_config&&b.fetch_remote_config(b.remote_config)}}};b.group_features=function(a){if(a)for(var b in a)m[b]?i("Feature name "+b+" is already reserved"):"string"===typeof a[b]?m[b]={features:[a[b]]}:a[b]&&Array.isArray(a[b])&&a[b].length?
m[b]={features:a[b]}:i("Incorrect feature list for "+b+" value: "+a[b]);else i("Incorrect features: "+a)};b.check_consent=function(a){if(!b.require_consent)return!0;if(m[a])return m[a]&&m[a].optin?!0:!1;i("No feature available for "+a);return!1};b.check_any_consent=function(){if(!b.require_consent)return!0;for(var a in m)if(m[a]&&m[a].optin)return!0;return!1};b.add_consent=function(a){i("Adding consent for "+a);if(Array.isArray(a))for(var c=0;c<a.length;c++)b.add_consent(a[c]);else m[a]?m[a].features?
(m[a].optin=!0,b.add_consent(m[a].features)):!0!==m[a].optin&&(y[a]=!0,m[a].optin=!0,Ka(),setTimeout(function(){"sessions"===a&&t.begin_session?(b.begin_session.apply(b,t.begin_session),t.begin_session=null):"views"===a&&t.track_pageview&&(G=null,b.track_pageview.apply(b,t.track_pageview),t.track_pageview=null);t.change_id&&(b.change_id.apply(b,t.change_id),t.change_id=null)},1)):i("No feature available for "+a)};b.remove_consent=function(a){i("Removing consent for "+a);if(Array.isArray(a))for(var c=
0;c<a.length;c++)b.remove_consent(a[c]);else m[a]?(m[a].features?b.remove_consent(m[a].features):!1!==m[a].optin&&(y[a]=!1,Ka()),m[a].optin=!1):i("No feature available for "+a)};var C,Ka=function(){C&&(clearTimeout(C),C=null);C=setTimeout(function(){ua(y)&&(r({consent:JSON.stringify(y)}),y={})},1E3)};b.enable_offline_mode=function(){w=!0;b.device_id="[CLY]_temp_id"};b.disable_offline_mode=function(a){w=!1;a&&b.device_id!==a?(b.device_id=a,g("cly_id",b.device_id),i("Changing id")):(b.device_id=ha(),
b.device_id!==g("cly_id")&&g("cly_id",b.device_id));a=!1;if(0<p.length)for(var c=0;c<p.length;c++)"[CLY]_temp_id"===p[c].device_id&&(p[c].device_id=b.device_id,a=!0);a&&g("cly_queue",p,!0)};b.begin_session=function(a,c){if(b.check_consent("sessions")){if(!A){b.report_orientation();l(window,"resize",function(){b.report_orientation()});B=n();A=!0;P=a?!1:!0;var e=g("cly_session");if(c||!K||!e||parseInt(e)<=n())i("Session started"),e={begin_session:1},e.metrics=JSON.stringify(T()),r(e);g("cly_session",
n()+60*Q)}}else t.begin_session=arguments};b.session_duration=function(a){b.check_consent("sessions")&&A&&(i("Session extended",a),r({session_duration:a}),ra())};b.end_session=function(a,c){b.check_consent("sessions")&&A&&(a=a||n()-B,aa(),!K||c?(i("Ending session"),r({end_session:1,session_duration:a})):b.session_duration(a),A=!1)};b.change_id=function(a,c){if(b.device_id!==a){c||(0<q.length&&(r({events:JSON.stringify(q)}),q=[],g("cly_event",q)),b.end_session(null,!0),E={});var e=b.device_id;b.device_id=
a;g("cly_id",b.device_id);i("Changing id");c?b.check_any_consent()?r({old_device_id:e}):t.change_id=arguments:b.begin_session(!P,!0);b.remote_config&&(u={},g("cly_remote_configs",u),b.fetch_remote_config(b.remote_config))}};b.add_event=function(a){b.check_consent("events")&&s(a)};b.start_event=function(a){E[a]?i("Timed event with key "+a+" already started"):E[a]=n()};b.end_event=function(a){"string"==typeof a&&(a={key:a});a.key?E[a.key]?(a.dur=n()-E[a.key],b.add_event(a),delete E[a.key]):i("Timed event with key "+
a.key+" was not started"):i("Event must have key property")};b.report_orientation=function(a){s({key:"[CLY]_orientation",segmentation:{mode:a||(window.innerWidth>window.innerHeight?"landscape":"portrait")}})};b.report_conversion=function(a,c){b.check_consent("attribution")&&(a=a||g("cly_cmp_id")||"cly_organic",c=c||g("cly_cmp_uid"),a&&c?r({campaign_id:a,campaign_user:c}):a&&r({campaign_id:a}))};b.user_details=function(a){b.check_consent("users")&&(i("Adding userdetails: ",a),r({user_details:JSON.stringify(J(a,
"name username email organization phone picture gender byear custom".split(" ")))}))};var v={},x=function(a,c,e){b.check_consent("users")&&(v[a]||(v[a]={}),"$push"===e||"$pull"===e||"$addToSet"===e?(v[a][e]||(v[a][e]=[]),v[a][e].push(c)):v[a][e]=c)};b.userData={set:function(a,b){v[a]=b},unset:function(a){v[a]=""},set_once:function(a,b){x(a,b,"$setOnce")},increment:function(a){x(a,1,"$inc")},increment_by:function(a,b){x(a,b,"$inc")},multiply:function(a,b){x(a,b,"$mul")},max:function(a,b){x(a,b,"$max")},
min:function(a,b){x(a,b,"$min")},push:function(a,b){x(a,b,"$push")},push_unique:function(a,b){x(a,b,"$addToSet")},pull:function(a,b){x(a,b,"$pull")},save:function(){b.check_consent("users")&&r({user_details:JSON.stringify({custom:v})});v={}}};b.report_trace=function(a){if(b.check_consent("apm")){for(var c="type name stz etz apm_metrics apm_attr".split(" "),e=0;e<c.length;e++)if("apm_attr"!==c[e]&&"undefined"===typeof a[c[e]]){i("APM trace must have a",c[e]);return}c=J(a,c);c.timestamp=a.stz;a=new Date;
c.hour=a.getHours();c.dow=a.getDay();r({apm:JSON.stringify(c)});i("Adding APM trace: ",c)}};b.track_errors=function(a){xa=a;window.onerror=function(a,b,f,j,d){if("undefined"!==typeof d)M(d,!1);else{var j=j||window.event&&window.event.errorCharacter,h="";"undefined"!==typeof a&&(h+=a+"\n");"undefined"!==typeof b&&(h+="at "+b);"undefined"!==typeof f&&(h+=":"+f);"undefined"!==typeof j&&(h+=":"+j);h+="\n";try{for(var i=[],g=arguments.callee.caller;g;)i.push(g.name),g=g.caller;h+=i.join("\n")}catch(k){}M(h,
!1)}};window.addEventListener("unhandledrejection",function(a){M(Error("Unhandled rejection (reason: "+(a.reason&&a.reason.stack?a.reason.stack:a.reason)+")."),!0)})};b.log_error=function(a,b){M(a,!0,b)};b.add_log=function(a){b.check_consent("crashes")&&(I.length>la&&I.shift(),I.push(a))};b.fetch_remote_config=function(a,c,e){if(b.check_any_consent()){var f={method:"fetch_remote_config"};b.check_consent("sessions")&&(f.metrics=JSON.stringify(T()));a&&(!e&&"function"===typeof a?(e=a,a=null):Array.isArray(a)&&
a.length&&(f.keys=JSON.stringify(a)));c&&(!e&&"function"===typeof c?(e=c,c=null):Array.isArray(c)&&c.length&&(f.omit_keys=JSON.stringify(c)));sa(f);L(b.url+"/o/sdk",f,function(a,b,c){try{var i=JSON.parse(c);if(f.keys||f.omit_keys)for(var k in i)u[k]=i[k];else u=i;g("cly_remote_configs",u)}catch(l){}"function"===typeof e&&e(a,u)})}};b.get_remote_config=function(a){return"undefined"!==typeof a?u[a]:u};b.stop_time=function(){H&&(H=!1,Ja=n()-B,O=n()-N)};b.start_time=function(){H||(H=!0,B=n()-Ja,N=n()-
O,O=0,ra())};b.track_sessions=function(){function a(){document[e]?b.stop_time():b.start_time()}function c(){W>=V&&b.start_time();W=0}b.begin_session();b.start_time();l(window,"beforeunload",function(){b.end_session()});l(window,"unload",function(){b.end_session()});var e="hidden";e in document?document.addEventListener("visibilitychange",a):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",
a):(e="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?(l(window,"focusin",function(){b.start_time()}),l(window,"focusout",function(){b.stop_time()})):(l(window,"focus",function(){b.start_time()}),l(window,"blur",function(){b.stop_time()}),l(window,"pageshow",function(){b.start_time()}),l(window,"pagehide",function(){b.stop_time()}));l(window,"mousemove",c);l(window,"click",c);l(window,"keydown",c);l(window,"scroll",c);setInterval(function(){W++;W>=V&&
b.stop_time()},6E4)};b.track_pageview=function(a,c,e){aa();a&&Array.isArray(a)&&(c=a,a=null);a||(a=b.getViewName());if(c&&c.length)for(var f=0;f<c.length;f++)try{if(RegExp(c[f]).test(a)){i("Ignored:",a);return}}catch(j){i("Problem with regex",c[f])}G=a;N=n();f={name:a,visit:1,domain:window.location.hostname,view:b.getViewUrl()};if("undefined"!==typeof document.referrer&&document.referrer.length){var d=wa.exec(document.referrer);d&&(d[11]&&d[11]!==window.location.hostname)&&(f.start=1)}if(e)for(var h in e)"undefined"===
typeof f[h]&&(f[h]=e[h]);b.check_consent("views")?s({key:"[CLY]_view",segmentation:f}):t.track_pageview=arguments};b.track_view=function(a,c,e){b.track_pageview(a,c,e)};b.track_clicks=function(a){var a=a||document,c=!0;l(a,"click",function(a){if(c){c=!1;ia(a);if("undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY){var f=ja(),j=ka();b.check_consent("clicks")&&s({key:"[CLY]_action",segmentation:{type:"click",x:a.pageX,y:a.pageY,width:j,height:f,domain:window.location.hostname,view:b.getViewUrl()}})}setTimeout(function(){c=
!0},1E3)}})};b.track_scrolls=function(a){function c(){if(e){e=!1;var a=ja(),c=ka(),h=Ba();b.check_consent("scrolls")&&s({key:"[CLY]_action",segmentation:{type:"scroll",y:f+h,width:c,height:a,domain:window.location.hostname,view:b.getViewUrl()}})}}var a=a||window,e=!0,f=0;l(a,"scroll",function(){f=Math.max(f,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)});l(a,"beforeunload",c);l(a,"unload",c)};b.track_links=function(a){a=a||document;l(a,"click",function(a){var e=X(a).closest("a");
e&&(ia(a),b.check_consent("clicks")&&s({key:"linkClick",segmentation:{href:e.href,text:e.innerText,id:e.id,view:b.getViewUrl()}}))})};b.track_forms=function(a,c){function e(a){return a.name||a.id||a.type||a.nodeName}a=a||document;l(a,"submit",function(a){var a=X(a),j={id:a.id,name:a.name,action:a.action,method:a.method,view:b.getViewUrl()},d;if("undefined"!==typeof a.elements){for(var h=0;h<a.elements.length;h++)if((d=a.elements[h])&&"password"!==d.type&&-1===d.className.indexOf("cly_user_ignore"))"undefined"===
typeof j["input:"+e(d)]&&(j["input:"+e(d)]=[]),"select"===d.nodeName.toLowerCase()?"undefined"!==typeof d.multiple?j["input:"+e(d)].push(oa(d)):j["input:"+e(d)].push(d.options[d.selectedIndex].value):"input"===d.nodeName.toLowerCase()?"undefined"!==typeof d.type?"checkbox"===d.type.toLowerCase()||"radio"===d.type.toLowerCase()?d.checked&&j["input:"+e(d)].push(d.value):("hidden"!==d.type.toLowerCase()||c)&&j["input:"+e(d)].push(d.value):j["input:"+e(d)].push(d.value):"textarea"===d.nodeName.toLowerCase()?
j["input:"+e(d)].push(d.value):"undefined"!==typeof d.value&&j["input:"+e(d)].push(d.value);for(var i in j)"undefined"!=typeof j[i].join&&(j[i]=j[i].join(", "))}b.check_consent("forms")&&s({key:"formSubmit",segmentation:j})})};b.collect_from_forms=function(a,c){a=a||document;l(a,"submit",function(e){var e=X(e),f={},j=!1,d;if("undefined"!==typeof e.elements){var h={},g=a.getElementsByTagName("LABEL"),k;for(k=0;k<g.length;k++)g[k].htmlFor&&""!==g[k].htmlFor&&(h[g[k].htmlFor]=g[k].innerText||g[k].textContent||
g[k].innerHTML);for(k=0;k<e.elements.length;k++)if((d=e.elements[k])&&"password"!==d.type&&-1===d.className.indexOf("cly_user_ignore"))if(g="","select"===d.nodeName.toLowerCase()?g="undefined"!==typeof d.multiple?oa(d):d.options[d.selectedIndex].value:"input"===d.nodeName.toLowerCase()?"undefined"!==typeof d.type?"checkbox"===d.type.toLowerCase()||"radio"===d.type.toLowerCase()?d.checked&&(g=d.value):g=d.value:g=d.value:"textarea"===d.nodeName.toLowerCase()?g=d.value:"undefined"!==typeof d.value&&
(g=d.value),d.className&&-1!==d.className.indexOf("cly_user_")){var l=d.className.split(" ");for(d=0;d<l.length;d++)if(0===l[d].indexOf("cly_user_")){f[l[d].replace("cly_user_","")]=g;j=!0;break}}else if(d.type&&"email"===d.type.toLowerCase()||d.name&&-1!==d.name.toLowerCase().indexOf("email")||d.id&&-1!==d.id.toLowerCase().indexOf("email")||d.id&&h[d.id]&&-1!==h[d.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(g))f.email||(f.email=g),j=!0;else if(d.name&&-1!==d.name.toLowerCase().indexOf("username")||
d.id&&-1!==d.id.toLowerCase().indexOf("username")||d.id&&h[d.id]&&-1!==h[d.id].toLowerCase().indexOf("username"))f.username||(f.username=g),j=!0;else if(d.name&&(-1!==d.name.toLowerCase().indexOf("tel")||-1!==d.name.toLowerCase().indexOf("phone")||-1!==d.name.toLowerCase().indexOf("number"))||d.id&&(-1!==d.id.toLowerCase().indexOf("tel")||-1!==d.id.toLowerCase().indexOf("phone")||-1!==d.id.toLowerCase().indexOf("number"))||d.id&&h[d.id]&&(-1!==h[d.id].toLowerCase().indexOf("tel")||-1!==h[d.id].toLowerCase().indexOf("phone")||
-1!==h[d.id].toLowerCase().indexOf("number")))f.phone||(f.phone=g),j=!0;else if(d.name&&(-1!==d.name.toLowerCase().indexOf("org")||-1!==d.name.toLowerCase().indexOf("company"))||d.id&&(-1!==d.id.toLowerCase().indexOf("org")||-1!==d.id.toLowerCase().indexOf("company"))||d.id&&h[d.id]&&(-1!==h[d.id].toLowerCase().indexOf("org")||-1!==h[d.id].toLowerCase().indexOf("company")))f.organization||(f.organization=g),j=!0;else if(d.name&&-1!==d.name.toLowerCase().indexOf("name")||d.id&&-1!==d.id.toLowerCase().indexOf("name")||
d.id&&h[d.id]&&-1!==h[d.id].toLowerCase().indexOf("name"))f.name||(f.name=""),f.name+=g+" ",j=!0}j&&(i("Gathered user data",f),c?b.user_details({custom:f}):b.user_details(f))})};b.collect_from_facebook=function(a){FB&&FB.api&&FB.api("/me",function(c){var e={};c.name&&(e.name=c.name);c.email&&(e.email=c.email);"male"===c.gender?e.gender="M":"female"===c.gender&&(e.gender="F");if(c.birthday){var f=c.birthday.split("/").pop();f&&4===f.length&&(e.byear=f)}c.work&&(c.work[0]&&c.work[0].employer&&c.work[0].employer.name)&&
(e.organization=c.work[0].employer.name);if(a){e.custom={};for(var j in a){for(var f=a[j].split("."),d=c,g=0;g<f.length&&!(d=d[f[g]],"undefined"===typeof d);g++);"undefined"!==typeof d&&(e.custom[j]=d)}}b.user_details(e)})};b.opt_out=function(){b.ignore_visitor=!0;g("cly_ignore",!0)};b.opt_in=function(){g("cly_ignore",!1);b.ignore_visitor=!1;na();!b.ignore_visitor&&!ca&&R()};b.report_feedback=function(a){if(b.check_consent("star-rating"))if(a.widget_id)if(a.rating){if(b.check_consent("events")){var c=
{key:"[CLY]_star_rating",count:1,segmentation:{}};c.segmentation=J(a,"widget_id contactMe platform app_version rating email comment".split(" "));c.segmentation.app_version||(c.segmentation.app_version=b.metrics._app_version||b.app_version);i("Reporting feedback: ",c);b.add_event(c)}}else i("Feedback must contain rating property");else i("Feedback must contain widget_id property")};b.show_feedback_popup=function(a){w?i("Cannot show feedback popup in offline mode"):L(b.url+"/o/feedback/widget",{widget_id:a},
function(a,b,f){a&&i("Error occurred",a);try{var g=JSON.parse(f);$(g,!1)}catch(d){i("JSON parse failed: "+d)}})};b.enable_feedback=function(a){w?i("Cannot enable feedback in offline mode"):(Fa(b.url+"/star-rating/stylesheets/countly-feedback-web.css"),a=a.popups||a.widgets,0<a.length?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),L(b.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a)},function(a,b,f){a&&i("Errors occurred:",a);try{for(var g=JSON.parse(f),a=
0;a<g.length;a++)if("true"===g[a].is_active&&g[a].target_devices[ma.device])if("string"===typeof g[a].hide_sticker&&(g[a].hide_sticker="true"===g[a].hide_sticker?!0:!1),"all"===g[a].target_page&&!g[a].hide_sticker)$(g[a],!0);else for(var d=g[a].target_pages,b=0;b<d.length;b++)d[b]===window.location.pathname&&!g[a].hide_sticker&&$(g[a],!0)}catch(h){i("JSON parse error: "+h)}})):i("You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback"))};
Element.prototype.closest||(Element.prototype.closest=function(a){for(var b=this,a=a.toUpperCase();b;){if(b.nodeName.toUpperCase()===a)return b;b=b.parentElement}});var l=function(a,b,e){"undefined"!==typeof a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent("on"+b,e)},X=function(a){return a?"undefined"!==typeof a.target?a.target:a.srcElement:window.event.srcElement},ma,Y=navigator.userAgent.toLowerCase(),F=function(a){a&&(Y=(a+"").toLowerCase());return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(Y)?
"tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(Y)?"phone":"desktop"};ma={device:F(),detect:F,isMobile:"desktop"!==F()?!0:!1,userAgent:Y};var g=function(a,c,e){function f(a,b,c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var a=b.namespace+a,e=e||!1,g=!1,d,g=!0;try{"undefined"!==typeof localStorage&&localStorage.setItem("testLocal",
!0)}catch(h){g=!1}"undefined"!==typeof c&&null!==c&&(c=b.serialize(c),g?localStorage.setItem(a,c):e||f(a,c,30));if("undefined"===typeof c){if(g)d=localStorage.getItem(a);else if(!e)a:{a+="=";c=document.cookie.split(";");e=0;for(g=c.length;e<g;e++){for(d=c[e];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a)){d=d.substring(a.length,d.length);break a}}d=null}return b.deserialize(d)}null===c&&(g?localStorage.removeItem(a):e||f(a,"",-1))};window.addEventListener("storage",function(a){switch(a.key+
""){case b.namespace+"cly_queue":p=b.deserialize(a.newValue||"[]");break;case b.namespace+"cly_event":q=b.deserialize(a.newValue||"[]");break;case b.namespace+"cly_remote_configs":u=b.deserialize(a.newValue||"{}");break;case b.namespace+"cly_ignore":b.ignore_visitor=b.deserialize(a.newValue);break;case b.namespace+"cly_id":b.device_id=b.deserialize(a.newValue)}});b.serialize=function(a){"object"===typeof a&&(a=JSON.stringify(a));return a};b.deserialize=function(a){try{a=JSON.parse(a)}catch(b){}return a};
b.getViewName=function(){return window.location.pathname};b.getViewUrl=function(){return window.location.pathname};b._internals={store:g,getDocWidth:ka,getDocHeight:ja,getViewportHeight:Ba,get_page_coord:ia,get_event_target:X,add_event:l,getProperties:J,stripTrailingSlash:Aa,prepareParams:za,sendXmlHttpRequest:L,recordError:M,getMsTimestamp:Z,getTimestamp:n,log:i,getMetrics:T,generateUUID:va,isUUID:function(){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(b.device_id)},
getId:ha,heartBeat:R,toRequestQueue:r,reportViewDuration:aa,loadJS:Ea,loadCSS:Fa,getLastView:function(){return G},setToken:Ca,getToken:function(){var a=g("cly_token");g("cly_token",null);return a},showLoader:Ga,hideLoader:Ha,add_cly_events:s,detect_device:ma,getRequestQueue:function(){return p},getEventQueue:function(){return q},clearQueue:function(){p=[];g("cly_queue",[]);q=[];g("cly_event",[])}};return b});
